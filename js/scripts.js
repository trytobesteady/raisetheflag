(function(a,b){"use strict";var c=function(){var a={};function b(){}b()}();THREE.SpriteCanvasMaterial=function(a){THREE.Material.call(this);this.type="SpriteCanvasMaterial";this.color=new THREE.Color(16777215);this.program=function(a,b){};this.setValues(a)};THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteCanvasMaterial.prototype.constructor=THREE.SpriteCanvasMaterial;THREE.SpriteCanvasMaterial.prototype.clone=function(){var a=new THREE.SpriteCanvasMaterial;a.copy(this);a.color.copy(this.color);a.program=this.program;return a};THREE.CanvasRenderer=function(a){console.log("THREE.CanvasRenderer",THREE.REVISION);a=a||{};var b=this,c,d,e,f=new THREE.Projector,g=a.canvas!==undefined?a.canvas:document.createElement("canvas"),h=g.width,i=g.height,j=Math.floor(h/2),k=Math.floor(i/2),l=0,m=0,n=h,o=i,p=1,q=g.getContext("2d",{alpha:a.alpha===true}),r=new THREE.Color(0),s=a.alpha===true?0:1,t=1,u=0,v=null,w=null,x=null,y=null,z=null,A=[],B,C,D,E,F,G=new THREE.RenderableVertex,H=new THREE.RenderableVertex,I,J,K,L,M,N,O,P,Q,R,S,T,U=new THREE.Color,V=new THREE.Color,W=new THREE.Color,X=new THREE.Color,Y=new THREE.Color,Z=new THREE.Color,$=new THREE.Color,_=new THREE.Color,aa={},ba,ca,da,ea,fa,ga,ha,ia,ja=new THREE.Box2,ka=new THREE.Box2,la=new THREE.Box2,ma=new THREE.Color,na=new THREE.Color,oa=new THREE.Color,pa=new THREE.Vector3,qa=new THREE.Vector3,ra=new THREE.Vector3,sa=new THREE.Matrix3;if(q.setLineDash===undefined){q.setLineDash=function(){}}this.domElement=g;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.supportsVertexTextures=function(){};this.setFaceCulling=function(){};this.getContext=function(){return q};this.getContextAttributes=function(){return q.getContextAttributes()};this.getPixelRatio=function(){return p};this.setPixelRatio=function(a){if(a!==undefined)p=a};this.setSize=function(a,b,c){h=a*p;i=b*p;g.width=h;g.height=i;j=Math.floor(h/2);k=Math.floor(i/2);if(c!==false){g.style.width=a+"px";g.style.height=b+"px"}ja.min.set(-j,-k);ja.max.set(j,k);ka.min.set(-j,-k);ka.max.set(j,k);t=1;u=0;v=null;w=null;x=null;y=null;z=null;this.setViewport(0,0,a,b)};this.setViewport=function(a,b,c,d){l=a*p;m=b*p;n=c*p;o=d*p};this.setScissor=function(){};this.setScissorTest=function(){};this.setClearColor=function(a,b){r.set(a);s=b!==undefined?b:1;ka.min.set(-j,-k);ka.max.set(j,k)};this.setClearColorHex=function(a,b){console.warn("THREE.CanvasRenderer: .setClearColorHex() is being removed. Use .setClearColor() instead.");this.setClearColor(a,b)};this.getClearColor=function(){return r};this.getClearAlpha=function(){return s};this.getMaxAnisotropy=function(){return 0};this.clear=function(){if(ka.isEmpty()===false){ka.intersect(ja);ka.expandByScalar(2);ka.min.x=ka.min.x+j;ka.min.y=-ka.min.y+k;ka.max.x=ka.max.x+j;ka.max.y=-ka.max.y+k;if(s<1){q.clearRect(ka.min.x|0,ka.max.y|0,ka.max.x-ka.min.x|0,ka.min.y-ka.max.y|0)}if(s>0){Ga(THREE.NormalBlending);Fa(1);La("rgba("+Math.floor(r.r*255)+","+Math.floor(r.g*255)+","+Math.floor(r.b*255)+","+s+")");q.fillRect(ka.min.x|0,ka.max.y|0,ka.max.x-ka.min.x|0,ka.min.y-ka.max.y|0)}ka.makeEmpty()}};this.clearColor=function(){};this.clearDepth=function(){};this.clearStencil=function(){};this.render=function(a,g){if(g instanceof THREE.Camera===false){console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");return}var p=a.background;if(p&&p.isColor){La("rgb("+Math.floor(p.r*255)+","+Math.floor(p.g*255)+","+Math.floor(p.b*255)+")");q.fillRect(0,0,h,i)}else if(this.autoClear===true){this.clear()}b.info.render.vertices=0;b.info.render.faces=0;q.setTransform(n/h,0,0,-o/i,l,i-m);q.translate(j,k);c=f.projectScene(a,g,this.sortObjects,this.sortElements);d=c.elements;e=c.lights;B=g;sa.getNormalMatrix(g.matrixWorldInverse);ta();for(var r=0,s=d.length;r<s;r++){var t=d[r];var u=t.material;if(u===undefined||u.opacity===0)continue;la.makeEmpty();if(t instanceof THREE.RenderableSprite){C=t;C.x*=j;C.y*=k;va(C,t,u)}else if(t instanceof THREE.RenderableLine){C=t.v1;D=t.v2;C.positionScreen.x*=j;C.positionScreen.y*=k;D.positionScreen.x*=j;D.positionScreen.y*=k;la.setFromPoints([C.positionScreen,D.positionScreen]);if(ja.intersectsBox(la)===true){wa(C,D,t,u)}}else if(t instanceof THREE.RenderableFace){C=t.v1;D=t.v2;E=t.v3;if(C.positionScreen.z<-1||C.positionScreen.z>1)continue;if(D.positionScreen.z<-1||D.positionScreen.z>1)continue;if(E.positionScreen.z<-1||E.positionScreen.z>1)continue;C.positionScreen.x*=j;C.positionScreen.y*=k;D.positionScreen.x*=j;D.positionScreen.y*=k;E.positionScreen.x*=j;E.positionScreen.y*=k;if(u.overdraw>0){Ea(C.positionScreen,D.positionScreen,u.overdraw);Ea(D.positionScreen,E.positionScreen,u.overdraw);Ea(E.positionScreen,C.positionScreen,u.overdraw)}la.setFromPoints([C.positionScreen,D.positionScreen,E.positionScreen]);if(ja.intersectsBox(la)===true){xa(C,D,E,0,1,2,t,u)}}ka.union(la)}q.setTransform(1,0,0,1,0,0)};function ta(){ma.setRGB(0,0,0);na.setRGB(0,0,0);oa.setRGB(0,0,0);for(var a=0,b=e.length;a<b;a++){var c=e[a];var d=c.color;if(c instanceof THREE.AmbientLight){ma.add(d)}else if(c instanceof THREE.DirectionalLight){na.add(d)}else if(c instanceof THREE.PointLight){oa.add(d)}}}function ua(a,b,c){for(var d=0,f=e.length;d<f;d++){var g=e[d];_.copy(g.color);if(g instanceof THREE.DirectionalLight){var h=pa.setFromMatrixPosition(g.matrixWorld).normalize();var i=b.dot(h);if(i<=0)continue;i*=g.intensity;c.add(_.multiplyScalar(i))}else if(g instanceof THREE.PointLight){var h=pa.setFromMatrixPosition(g.matrixWorld);var i=b.dot(pa.subVectors(h,a).normalize());if(i<=0)continue;i*=g.distance==0?1:1-Math.min(a.distanceTo(h)/g.distance,1);if(i==0)continue;i*=g.intensity;c.add(_.multiplyScalar(i))}}}function va(a,b,c){Fa(c.opacity);Ga(c.blending);var d=b.scale.x*j;var e=b.scale.y*k;var f=.5*Math.sqrt(d*d+e*e);la.min.set(a.x-f,a.y-f);la.max.set(a.x+f,a.y+f);if(c instanceof THREE.SpriteMaterial){var g=c.map;if(g!==null){var h=aa[g.id];if(h===undefined||h.version!==g.version){h=Ba(g);aa[g.id]=h}if(h.canvas!==undefined){La(h.canvas);var i=g.image;var l=i.width*g.offset.x;var m=i.height*g.offset.y;var n=i.width*g.repeat.x;var o=i.height*g.repeat.y;var p=d/n;var r=e/o;q.save();q.translate(a.x,a.y);if(c.rotation!==0)q.rotate(c.rotation);q.translate(-d/2,-e/2);q.scale(p,r);q.translate(-l,-m);q.fillRect(l,m,n,o);q.restore()}}else{La(c.color.getStyle());q.save();q.translate(a.x,a.y);if(c.rotation!==0)q.rotate(c.rotation);q.scale(d,-e);q.fillRect(-.5,-.5,1,1);q.restore()}}else if(c instanceof THREE.SpriteCanvasMaterial){Ka(c.color.getStyle());La(c.color.getStyle());q.save();q.translate(a.x,a.y);if(c.rotation!==0)q.rotate(c.rotation);q.scale(d,e);c.program(q);q.restore()}}function wa(a,b,c,d){Fa(d.opacity);Ga(d.blending);q.beginPath();q.moveTo(a.positionScreen.x,a.positionScreen.y);q.lineTo(b.positionScreen.x,b.positionScreen.y);if(d instanceof THREE.LineBasicMaterial){Ha(d.linewidth);Ia(d.linecap);Ja(d.linejoin);if(d.vertexColors!==THREE.VertexColors){Ka(d.color.getStyle())}else{var e=c.vertexColors[0].getStyle();var f=c.vertexColors[1].getStyle();if(e===f){Ka(e)}else{try{var g=q.createLinearGradient(a.positionScreen.x,a.positionScreen.y,b.positionScreen.x,b.positionScreen.y);g.addColorStop(0,e);g.addColorStop(1,f)}catch(h){g=e}Ka(g)}}q.stroke();la.expandByScalar(d.linewidth*2)}else if(d instanceof THREE.LineDashedMaterial){Ha(d.linewidth);Ia(d.linecap);Ja(d.linejoin);Ka(d.color.getStyle());Ma([d.dashSize,d.gapSize]);q.stroke();la.expandByScalar(d.linewidth*2);Ma([])}}function xa(a,c,d,e,f,g,h,i){b.info.render.vertices+=3;b.info.render.faces++;Fa(i.opacity);Ga(i.blending);I=a.positionScreen.x;J=a.positionScreen.y;K=c.positionScreen.x;L=c.positionScreen.y;M=d.positionScreen.x;N=d.positionScreen.y;ya(I,J,K,L,M,N);if((i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshPhongMaterial)&&i.map===null){Z.copy(i.color);$.copy(i.emissive);if(i.vertexColors===THREE.FaceColors){Z.multiply(h.color)}U.copy(ma);qa.copy(a.positionWorld).add(c.positionWorld).add(d.positionWorld).divideScalar(3);ua(qa,h.normalModel,U);U.multiply(Z).add($);i.wireframe===true?za(U,i.wireframeLinewidth,i.wireframeLinecap,i.wireframeLinejoin):Aa(U)}else if(i instanceof THREE.MeshBasicMaterial||i instanceof THREE.MeshLambertMaterial||i instanceof THREE.MeshPhongMaterial){if(i.map!==null){var j=i.map.mapping;if(j===THREE.UVMapping){ca=h.uvs;Ca(I,J,K,L,M,N,ca[e].x,ca[e].y,ca[f].x,ca[f].y,ca[g].x,ca[g].y,i.map)}}else if(i.envMap!==null){if(i.envMap.mapping===THREE.SphericalReflectionMapping){ra.copy(h.vertexNormalsModel[e]).applyMatrix3(sa);da=.5*ra.x+.5;ea=.5*ra.y+.5;ra.copy(h.vertexNormalsModel[f]).applyMatrix3(sa);fa=.5*ra.x+.5;ga=.5*ra.y+.5;ra.copy(h.vertexNormalsModel[g]).applyMatrix3(sa);ha=.5*ra.x+.5;ia=.5*ra.y+.5;Ca(I,J,K,L,M,N,da,ea,fa,ga,ha,ia,i.envMap)}}else{U.copy(i.color);if(i.vertexColors===THREE.FaceColors){U.multiply(h.color)}i.wireframe===true?za(U,i.wireframeLinewidth,i.wireframeLinecap,i.wireframeLinejoin):Aa(U)}}else if(i instanceof THREE.MeshNormalMaterial){ra.copy(h.normalModel).applyMatrix3(sa);U.setRGB(ra.x,ra.y,ra.z).multiplyScalar(.5).addScalar(.5);i.wireframe===true?za(U,i.wireframeLinewidth,i.wireframeLinecap,i.wireframeLinejoin):Aa(U)}else{U.setRGB(1,1,1);i.wireframe===true?za(U,i.wireframeLinewidth,i.wireframeLinecap,i.wireframeLinejoin):Aa(U)}}function ya(a,b,c,d,e,f){q.beginPath();q.moveTo(a,b);q.lineTo(c,d);q.lineTo(e,f);q.closePath()}function za(a,b,c,d){Ha(b);Ia(c);Ja(d);Ka(a.getStyle());q.stroke();la.expandByScalar(b*2)}function Aa(a){La(a.getStyle());q.fill()}function Ba(a){if(a.version===0||a instanceof THREE.CompressedTexture||a instanceof THREE.DataTexture){return{canvas:undefined,version:a.version}}var b=a.image;if(b.complete===false){return{canvas:undefined,version:0}}var c=a.wrapS===THREE.RepeatWrapping||a.wrapS===THREE.MirroredRepeatWrapping;var d=a.wrapT===THREE.RepeatWrapping||a.wrapT===THREE.MirroredRepeatWrapping;var e=a.wrapS===THREE.MirroredRepeatWrapping;var f=a.wrapT===THREE.MirroredRepeatWrapping;var g=document.createElement("canvas");g.width=b.width*(e?2:1);g.height=b.height*(f?2:1);var h=g.getContext("2d");h.setTransform(1,0,0,-1,0,b.height);h.drawImage(b,0,0);if(e===true){h.setTransform(-1,0,0,-1,b.width,b.height);h.drawImage(b,-b.width,0)}if(f===true){h.setTransform(1,0,0,1,0,0);h.drawImage(b,0,b.height)}if(e===true&&f===true){h.setTransform(-1,0,0,1,b.width,0);h.drawImage(b,-b.width,b.height)}var i="no-repeat";if(c===true&&d===true){i="repeat"}else if(c===true){i="repeat-x"}else if(d===true){i="repeat-y"}var j=q.createPattern(g,i);if(a.onUpdate)a.onUpdate(a);return{canvas:j,version:a.version}}function Ca(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=aa[m.id];if(n===undefined||n.version!==m.version){n=Ba(m);aa[m.id]=n}if(n.canvas!==undefined){La(n.canvas)}else{La("rgba( 0, 0, 0, 1)");q.fill();return}var o,p,r,s,t,u,v,w,x=m.offset.x/m.repeat.x,y=m.offset.y/m.repeat.y,z=m.image.width*m.repeat.x,A=m.image.height*m.repeat.y;g=(g+x)*z;h=(h+y)*A;i=(i+x)*z;j=(j+y)*A;k=(k+x)*z;l=(l+y)*A;c-=a;d-=b;e-=a;f-=b;i-=g;j-=h;k-=g;l-=h;v=i*l-k*j;if(v===0)return;w=1/v;o=(l*c-j*e)*w;p=(l*d-j*f)*w;r=(i*e-k*c)*w;s=(i*f-k*d)*w;t=a-o*g-r*h;u=b-p*g-s*h;q.save();q.transform(o,p,r,s,t,u);q.fill();q.restore()}function Da(a,b,c,d,e,f,g,h,i,j,k,l,m){var n,o,p,r,s,t,u,v,w=m.width-1,x=m.height-1;g*=w;h*=x;i*=w;j*=x;k*=w;l*=x;c-=a;d-=b;e-=a;f-=b;i-=g;j-=h;k-=g;l-=h;u=i*l-k*j;v=1/u;n=(l*c-j*e)*v;o=(l*d-j*f)*v;p=(i*e-k*c)*v;r=(i*f-k*d)*v;s=a-n*g-p*h;t=b-o*g-r*h;q.save();q.transform(n,o,p,r,s,t);q.clip();q.drawImage(m,0,0);q.restore()}function Ea(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=d*d+e*e,g;if(f===0)return;g=c/Math.sqrt(f);d*=g;e*=g;b.x+=d;b.y+=e;a.x-=d;a.y-=e}function Fa(a){if(t!==a){q.globalAlpha=a;t=a}}function Ga(a){if(u!==a){if(a===THREE.NormalBlending){q.globalCompositeOperation="source-over"}else if(a===THREE.AdditiveBlending){q.globalCompositeOperation="lighter"}else if(a===THREE.SubtractiveBlending){q.globalCompositeOperation="darker"}else if(a===THREE.MultiplyBlending){q.globalCompositeOperation="multiply"}u=a}}function Ha(a){if(x!==a){q.lineWidth=a;x=a}}function Ia(a){if(y!==a){q.lineCap=a;y=a}}function Ja(a){if(z!==a){q.lineJoin=a;z=a}}function Ka(a){if(v!==a){q.strokeStyle=a;v=a}}function La(a){if(w!==a){q.fillStyle=a;w=a}}function Ma(a){if(A.length!==a.length){q.setLineDash(a);A=a}}};THREE.RenderableObject=function(){this.id=0;this.object=null;this.z=0;this.renderOrder=0};THREE.RenderableFace=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.normalModel=new THREE.Vector3;this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.vertexNormalsLength=0;this.color=new THREE.Color;this.material=null;this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2];this.z=0;this.renderOrder=0};THREE.RenderableVertex=function(){this.position=new THREE.Vector3;this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=true};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};THREE.RenderableLine=function(){this.id=0;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.vertexColors=[new THREE.Color,new THREE.Color];this.material=null;this.z=0;this.renderOrder=0};THREE.RenderableSprite=function(){this.id=0;this.object=null;this.x=0;this.y=0;this.z=0;this.rotation=0;this.scale=new THREE.Vector2;this.material=null;this.renderOrder=0};THREE.Projector=function(){var a,b,c=[],d=0,e,f,g=[],h=0,i,j,k=[],l=0,m,n,o=[],p=0,q,r,s=[],t=0,u={objects:[],lights:[],elements:[]},v=new THREE.Vector3,w=new THREE.Vector4,x=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),y=new THREE.Box3,z=new Array(3),A=new Array(4),B=new THREE.Matrix4,C=new THREE.Matrix4,D,E=new THREE.Matrix4,F=new THREE.Matrix3,G=new THREE.Frustum,H=new THREE.Vector4,I=new THREE.Vector4;this.projectVector=function(a,b){console.warn("THREE.Projector: .projectVector() is now vector.project().");a.project(b)};this.unprojectVector=function(a,b){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");a.unproject(b)};this.pickingRay=function(a,b){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")};var J=function(){var a=[];var b=[];var c=null;var d=null;var f=new THREE.Matrix3;function h(e){c=e;d=c.material;f.getNormalMatrix(c.matrixWorld);a.length=0;b.length=0}function j(a){var b=a.position;var c=a.positionWorld;var d=a.positionScreen;c.copy(b).applyMatrix4(D);d.copy(c).applyMatrix4(C);var e=1/d.w;d.x*=e;d.y*=e;d.z*=e;a.visible=d.x>=-1&&d.x<=1&&d.y>=-1&&d.y<=1&&d.z>=-1&&d.z<=1}function k(a,b,c){e=M();e.position.set(a,b,c);j(e)}function l(b,c,d){a.push(b,c,d)}function n(a,c){b.push(a,c)}function o(a,b,c){if(a.visible===true||b.visible===true||c.visible===true)return true;z[0]=a.positionScreen;z[1]=b.positionScreen;z[2]=c.positionScreen;return x.intersectsBox(y.setFromPoints(z))}function p(a,b,c){return(c.positionScreen.x-a.positionScreen.x)*(b.positionScreen.y-a.positionScreen.y)-(c.positionScreen.y-a.positionScreen.y)*(b.positionScreen.x-a.positionScreen.x)<0}function q(a,b){var d=g[a];var e=g[b];m=O();m.id=c.id;m.v1.copy(d);m.v2.copy(e);m.z=(d.positionScreen.z+e.positionScreen.z)/2;m.renderOrder=c.renderOrder;m.material=c.material;u.elements.push(m)}function r(e,h,j){var k=g[e];var l=g[h];var m=g[j];if(o(k,l,m)===false)return;if(d.side===THREE.DoubleSide||p(k,l,m)===true){i=N();i.id=c.id;i.v1.copy(k);i.v2.copy(l);i.v3.copy(m);i.z=(k.positionScreen.z+l.positionScreen.z+m.positionScreen.z)/3;i.renderOrder=c.renderOrder;i.normalModel.fromArray(a,e*3);i.normalModel.applyMatrix3(f).normalize();for(var n=0;n<3;n++){var q=i.vertexNormalsModel[n];q.fromArray(a,arguments[n]*3);q.applyMatrix3(f).normalize();var r=i.uvs[n];r.fromArray(b,arguments[n]*2)}i.vertexNormalsLength=3;i.material=c.material;u.elements.push(i)}}return{setObject:h,projectVertex:j,checkTriangleVisibility:o,checkBackfaceCulling:p,pushVertex:k,pushNormal:l,pushUv:n,pushLine:q,pushTriangle:r}};var K=new J;this.projectScene=function(c,d,e,h){j=0;n=0;r=0;u.elements.length=0;if(c.autoUpdate===true)c.updateMatrixWorld();if(d.parent===null)d.updateMatrixWorld();B.copy(d.matrixWorldInverse.getInverse(d.matrixWorld));C.multiplyMatrices(d.projectionMatrix,B);G.setFromMatrix(C);b=0;u.objects.length=0;u.lights.length=0;function k(b){a=L();a.id=b.id;a.object=b;v.setFromMatrixPosition(b.matrixWorld);v.applyMatrix4(C);a.z=v.z;a.renderOrder=b.renderOrder;u.objects.push(a)}c.traverseVisible(function(a){if(a instanceof THREE.Light){u.lights.push(a)}else if(a instanceof THREE.Mesh||a instanceof THREE.Line){if(a.material.visible===false)return;if(a.frustumCulled===true&&G.intersectsObject(a)===false)return;k(a)}else if(a instanceof THREE.Sprite){if(a.material.visible===false)return;if(a.frustumCulled===true&&G.intersectsSprite(a)===false)return;k(a)}});if(e===true){u.objects.sort(Q)}for(var l=0,o=u.objects.length;l<o;l++){var p=u.objects[l].object;var s=p.geometry;K.setObject(p);D=p.matrixWorld;f=0;if(p instanceof THREE.Mesh){if(s instanceof THREE.BufferGeometry){var t=s.attributes;var x=s.groups;if(t.position===undefined)continue;var y=t.position.array;for(var z=0,A=y.length;z<A;z+=3){K.pushVertex(y[z],y[z+1],y[z+2])}if(t.normal!==undefined){var J=t.normal.array;for(var z=0,A=J.length;z<A;z+=3){K.pushNormal(J[z],J[z+1],J[z+2])}}if(t.uv!==undefined){var S=t.uv.array;for(var z=0,A=S.length;z<A;z+=2){K.pushUv(S[z],S[z+1])}}if(s.index!==null){var T=s.index.array;if(x.length>0){for(var U=0;U<x.length;U++){var V=x[U];for(var z=V.start,A=V.start+V.count;z<A;z+=3){K.pushTriangle(T[z],T[z+1],T[z+2])}}}else{for(var z=0,A=T.length;z<A;z+=3){K.pushTriangle(T[z],T[z+1],T[z+2])}}}else{for(var z=0,A=y.length/3;z<A;z+=3){K.pushTriangle(z,z+1,z+2)}}}else if(s instanceof THREE.Geometry){var W=s.vertices;var X=s.faces;var Y=s.faceVertexUvs[0];F.getNormalMatrix(D);var Z=p.material;var $=Z instanceof THREE.MultiMaterial;var _=$===true?p.material:null;for(var aa=0,ba=W.length;aa<ba;aa++){var ca=W[aa];v.copy(ca);if(Z.morphTargets===true){var da=s.morphTargets;var ea=p.morphTargetInfluences;for(var fa=0,ga=da.length;fa<ga;fa++){var ha=ea[fa];if(ha===0)continue;var ia=da[fa];var ja=ia.vertices[aa];v.x+=(ja.x-ca.x)*ha;v.y+=(ja.y-ca.y)*ha;v.z+=(ja.z-ca.z)*ha}}K.pushVertex(v.x,v.y,v.z)}for(var ka=0,la=X.length;ka<la;ka++){var ma=X[ka];Z=$===true?_.materials[ma.materialIndex]:p.material;if(Z===undefined)continue;var na=Z.side;var oa=g[ma.a];var pa=g[ma.b];var qa=g[ma.c];if(K.checkTriangleVisibility(oa,pa,qa)===false)continue;var ra=K.checkBackfaceCulling(oa,pa,qa);if(na!==THREE.DoubleSide){if(na===THREE.FrontSide&&ra===false)continue;if(na===THREE.BackSide&&ra===true)continue}i=N();i.id=p.id;i.v1.copy(oa);i.v2.copy(pa);i.v3.copy(qa);i.normalModel.copy(ma.normal);if(ra===false&&(na===THREE.BackSide||na===THREE.DoubleSide)){i.normalModel.negate()}i.normalModel.applyMatrix3(F).normalize();var sa=ma.vertexNormals;for(var ta=0,ua=Math.min(sa.length,3);ta<ua;ta++){var va=i.vertexNormalsModel[ta];va.copy(sa[ta]);if(ra===false&&(na===THREE.BackSide||na===THREE.DoubleSide)){va.negate()}va.applyMatrix3(F).normalize()}i.vertexNormalsLength=sa.length;var wa=Y[ka];if(wa!==undefined){for(var xa=0;xa<3;xa++){i.uvs[xa].copy(wa[xa])}}i.color=ma.color;i.material=Z;i.z=(oa.positionScreen.z+pa.positionScreen.z+qa.positionScreen.z)/3;i.renderOrder=p.renderOrder;u.elements.push(i)}}}else if(p instanceof THREE.Line){if(s instanceof THREE.BufferGeometry){var t=s.attributes;if(t.position!==undefined){var y=t.position.array;for(var z=0,A=y.length;z<A;z+=3){K.pushVertex(y[z],y[z+1],y[z+2])}if(s.index!==null){var T=s.index.array;for(var z=0,A=T.length;z<A;z+=2){K.pushLine(T[z],T[z+1])}}else{var ya=p instanceof THREE.LineSegments?2:1;for(var z=0,A=y.length/3-1;z<A;z+=ya){K.pushLine(z,z+1)}}}}else if(s instanceof THREE.Geometry){E.multiplyMatrices(C,D);var W=p.geometry.vertices;if(W.length===0)continue;oa=M();oa.positionScreen.copy(W[0]).applyMatrix4(E);var ya=p instanceof THREE.LineSegments?2:1;for(var aa=1,ba=W.length;aa<ba;aa++){oa=M();oa.positionScreen.copy(W[aa]).applyMatrix4(E);if((aa+1)%ya>0)continue;pa=g[f-2];H.copy(oa.positionScreen);I.copy(pa.positionScreen);if(R(H,I)===true){H.multiplyScalar(1/H.w);I.multiplyScalar(1/I.w);m=O();m.id=p.id;m.v1.positionScreen.copy(H);m.v2.positionScreen.copy(I);m.z=Math.max(H.z,I.z);m.renderOrder=p.renderOrder;m.material=p.material;if(p.material.vertexColors===THREE.VertexColors){m.vertexColors[0].copy(p.geometry.colors[aa]);m.vertexColors[1].copy(p.geometry.colors[aa-1])}u.elements.push(m)}}}}else if(p instanceof THREE.Sprite){w.set(D.elements[12],D.elements[13],D.elements[14],1);w.applyMatrix4(C);var za=1/w.w;w.z*=za;if(w.z>=-1&&w.z<=1){q=P();q.id=p.id;q.x=w.x*za;q.y=w.y*za;q.z=w.z;q.renderOrder=p.renderOrder;q.object=p;q.rotation=p.rotation;q.scale.x=p.scale.x*Math.abs(q.x-(w.x+d.projectionMatrix.elements[0])/(w.w+d.projectionMatrix.elements[12]));q.scale.y=p.scale.y*Math.abs(q.y-(w.y+d.projectionMatrix.elements[5])/(w.w+d.projectionMatrix.elements[13]));q.material=p.material;u.elements.push(q)}}}if(h===true){u.elements.sort(Q)}return u};function L(){if(b===d){var a=new THREE.RenderableObject;c.push(a);d++;b++;return a}return c[b++]}function M(){if(f===h){var a=new THREE.RenderableVertex;g.push(a);h++;f++;return a}return g[f++]}function N(){if(j===l){var a=new THREE.RenderableFace;k.push(a);l++;j++;return a}return k[j++]}function O(){if(n===p){var a=new THREE.RenderableLine;o.push(a);p++;n++;return a}return o[n++]}function P(){if(r===t){var a=new THREE.RenderableSprite;s.push(a);t++;r++;return a}return s[r++]}function Q(a,b){if(a.renderOrder!==b.renderOrder){return a.renderOrder-b.renderOrder}else if(a.z!==b.z){return b.z-a.z}else if(a.id!==b.id){return a.id-b.id}else{return 0}}function R(a,b){var c=0,d=1,e=a.z+a.w,f=b.z+b.w,g=-a.z+a.w,h=-b.z+b.w;if(e>=0&&f>=0&&g>=0&&h>=0){return true}else if(e<0&&f<0||g<0&&h<0){return false}else{if(e<0){c=Math.max(c,e/(e-f))}else if(f<0){d=Math.min(d,e/(e-f))}if(g<0){c=Math.max(c,g/(g-h))}else if(h<0){d=Math.min(d,g/(g-h))}if(d<c){return false}else{a.lerp(b,c);b.lerp(a,1-d);return true}}}};var d=function(){function a(a){e.appendChild(a.dom);return a}function b(a){for(var b=0;b<e.children.length;b++)e.children[b].style.display=b===a?"block":"none";c=a}var c=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000";e.addEventListener("click",function(a){a.preventDefault();b(++c%e.children.length)},!1);var f=(performance||Date).now(),g=f,h=0,i=a(new d.Panel("FPS","#0ff","#002")),j=a(new d.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var k=a(new d.Panel("MB","#f08","#201"));b(0);return{REVISION:16,dom:e,addPanel:a,showPanel:b,begin:function(){f=(performance||Date).now()},end:function(){h++;var a=(performance||Date).now();j.update(a-f,200);if(a>g+1e3&&(i.update(1e3*h/(a-g),100),g=a,h=0,k)){var b=performance.memory;k.update(b.usedJSHeapSize/1048576,b.jsHeapSizeLimit/1048576)}return a},update:function(){f=this.end()},domElement:e,setMode:b}};d.Panel=function(a,b,c){var d=Infinity,e=0,f=Math.round,g=f(window.devicePixelRatio||1),h=80*g,i=48*g,j=3*g,k=2*g,l=3*g,m=15*g,n=74*g,o=30*g,p=document.createElement("canvas");p.width=h;p.height=i;p.style.cssText="width:80px;height:48px";var q=p.getContext("2d");q.font="bold "+9*g+"px Helvetica,Arial,sans-serif";q.textBaseline="top";q.fillStyle=c;q.fillRect(0,0,h,i);q.fillStyle=b;q.fillText(a,j,k);q.fillRect(l,m,n,o);q.fillStyle=c;q.globalAlpha=.9;q.fillRect(l,m,n,o);return{dom:p,update:function(i,r){d=Math.min(d,i);e=Math.max(e,i);q.fillStyle=c;q.globalAlpha=1;q.fillRect(0,0,h,m);q.fillStyle=b;q.fillText(f(i)+" "+a+" ("+f(d)+"-"+f(e)+")",j,k);q.drawImage(p,l+g,m,n-g,o,l,m,n-g,o);q.fillRect(l+n-g,m,g,o);q.fillStyle=c;q.globalAlpha=.9;q.fillRect(l+n-g,m,g,f((1-i/r)*o))}}};"object"===typeof module&&(module.exports=d);b["true"]=a})({},function(){return this}());